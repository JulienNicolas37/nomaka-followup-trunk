// Peity jQuery plugin version 1.2.1
// (c) 2013 Ben Pickles
//
// http://benpickles.github.io/peity
//
// Released under MIT license.
(function(e,t,n,r){var i=t.createElement("canvas").getContext,s=e.fn.peity=function(t,n){i&&this.each(function(){var r=e(this),i=r.data("peity");if(i){t&&(i.type=t);e.extend(i.opts,n);i.draw()}else{var u=s.defaults[t],a={};e.each(r.data(),function(e,t){e in u&&(a[e]=t)});var f=e.extend({},u,a,n),i=new o(r,t,f);i.draw();r.change(function(){i.draw()}).data("peity",i)}});return this},o=function(e,t,n){this.$el=e;this.type=t;this.opts=n},u=o.prototype;u.colours=function(){var t=this.opts.colours,n=t;e.isFunction(n)||(n=function(e,n){return t[n%t.length]});return n};u.draw=function(){s.graphers[this.type].call(this,this.opts)};u.prepareCanvas=function(t,n){var i=this.canvas,s;if(i){this.context.clearRect(0,0,i.width,i.height);s=e(i)}else{s=e("<canvas>").css({height:n,width:t}).addClass("peity").data("peity",this);this.canvas=i=s[0];this.context=i.getContext("2d");this.$el.hide().after(i)}i.height=s.height()*r;i.width=s.width()*r;return i};u.values=function(){return e.map(this.$el.text().split(this.opts.delimiter),function(e){return parseFloat(e)})};s.defaults={};s.graphers={};s.register=function(e,t,n){this.defaults[e]=t;this.graphers[e]=n};s.register("pie",{colours:["#ff9900","#fff4dd","#ffc66e"],delimiter:null,diameter:16},function(e){if(!e.delimiter){var t=this.$el.text().match(/[^0-9\.]/);e.delimiter=t?t[0]:","}var r=this.values();if(e.delimiter=="/"){var i=r[0],s=r[1];r=[i,s-i]}var o=0,u=r.length,a=0;for(;o<u;o++)a+=r[o];var f=this.prepareCanvas(e.width||e.diameter,e.height||e.diameter),l=this.context,c=f.width,h=f.height,p=n.min(c,h)/2,d=n.PI,v=this.colours();l.save();l.translate(c/2,h/2);l.rotate(-d/2);for(o=0;o<u;o++){var m=r[o],g=m/a*d*2;l.beginPath();l.moveTo(0,0);l.arc(0,0,p,0,g,!1);l.fillStyle=v.call(this,m,o,r);l.fill();l.rotate(g)}l.restore()});s.register("line",{colour:"#c6d9fd",strokeColour:"#4d89f9",strokeWidth:1,delimiter:",",height:16,max:null,min:0,width:32},function(e){var t=this.values();t.length==1&&t.push(t[0]);var i=n.max.apply(n,t.concat([e.max])),s=n.min.apply(n,t.concat([e.min])),o=this.prepareCanvas(e.width,e.height),u=this.context,a=o.width,f=o.height-e.strokeWidth,l=a/(t.length-1),c=f/(i-s),h=[],p;u.beginPath();u.moveTo(0,f+s*c);for(p=0;p<t.length;p++){var d=p*l,v=f-c*(t[p]-s)+e.strokeWidth/2;h.push({x:d,y:v});u.lineTo(d,v)}u.lineTo(a,f+s*c);u.fillStyle=e.colour;u.fill();if(e.strokeWidth){u.beginPath();u.moveTo(0,h[0].y);for(p=0;p<h.length;p++)u.lineTo(h[p].x,h[p].y);u.lineWidth=e.strokeWidth*r;u.strokeStyle=e.strokeColour;u.stroke()}});s.register("bar",{colours:["#4D89F9"],delimiter:",",height:16,max:null,min:0,spacing:r,width:32},function(e){var t=this.values(),r=n.max.apply(n,t.concat([e.max])),i=n.min.apply(n,t.concat([e.min])),s=this.prepareCanvas(e.width,e.height),o=this.context,u=s.width,a=s.height,f=a/(r-i),l=e.spacing,c=(u+l)/t.length,h=this.colours();for(var p=0;p<t.length;p++){var d=t[p],v=a-f*(d-i),m;if(d==0){if(i>=0||r>0)v-=1;m=1}else m=f*t[p];o.fillStyle=h.call(this,d,p,t);o.fillRect(p*c,v,c-l,m)}})})(jQuery,document,Math,window.devicePixelRatio||1);